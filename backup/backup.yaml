# Sample pod to be applied manually when desired
# Executes a backup against the DB when tailored to the right endpoint.
# Copies resulting full backup to $BUCKET
apiVersion: v1
kind: Pod
metadata:
  name: neo4j-backup
spec:
  restartPolicy: Never
  containers:
    - name: neo4j-backup
      image: gcr.io/neo4j-k8s-marketplace-public/causal-cluster/backup:3.5
      env:
      - name: NEO4J_ADDR
        value: "neo4j-lsgm-neo4j-core-0.neo4j-lsgm-neo4j.default.svc.cluster.local"
      - name: BUCKET
        value: gs://tmp-k8s-backup-storage
      - name: BACKUP_NAME
        value: my-data
      - name: GOOGLE_APPLICATION_CREDENTIALS
        value: /auth/credentials.json
      volumeMounts:
      - name: creds
        mountPath: /auth
        readOnly: true
  volumes:
  - name: creds
    secret:
      secretName: neo4j-backup-sa
      items:
      - key: credentials.json
        path: credentials.json
---
apiVersion: v1
kind: Secret
metadata:
  name: "neo4j-backup-sa"
  labels:
    app.kubernetes.io/name: "neo4j-backup-sa"
  annotations:
    marketplace.cloud.google.com/verification: test
data:
  credentials.json: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibmVvNGotazhzLW1hcmtldHBsYWNlLXB1YmxpYyIsCiAgInByaXZhdGVfa2V5X2lkIjogIjNmMzE2MGQwMjc0ZmY1MDM5Y2MyZmQ5NTdiZjUyNzkxMTJiNDI5YWEiLAogICJwcml2YXRlX2tleSI6ICItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRQ0pmWFFCa29TRHozNXZcbnYzVndONUk2UlFlc2g1N0pOU0JYTFY3dFlGaTNobXBHTE9CcVVlWThicWZVcEhCblpkWm9UVjgzUFdsbk9xb25cbm14amc2UmFUY3Qrejh5VWVyNVBHQ1U4dDE5MkQ0UmlqR3NMMHFTUGd5KzBsOVhrMHQwWmxtV0JLc1llM1pTZDVcbjZxSVVMdll3MzdoYnFtbEJKeFNKKzFLc3VyL2hLM2VIbWlPcElwS0VIOEtpM2VGUkVwbFhnN0ZWWUVYZVZ2b2dcblF1bUFvbVp3VWU4QVI5bmpBREhiYWVNeDdCS3JvdjhQVDgwWkRsSkc4RkgxRTNhb2RncTI5allWUWxiTHdzVEVcbnlsb2txVmFEbFpadzVFNVlRYlZxUmowWWt6dENqcC8rUU9YYkVnQk9qdXA1cXVtWE4yeWZFaFFqaWhPNmNjR0Zcbm1TVGd3anc3QWdNQkFBRUNnZ0VBQjVFdkRGTWJGZ0lhakYzMlFibmRRM1cvS1dEQmZZTitCeTVKRmptQ1NIK09cblk5UmVlWnVPVjI4anI1RnBXbGVCaUhZUnNvR2Z4bjIxRmI3MGpKUm5tSy91M2dHWTNtcDljSjNjak1KZnY3MW9cbjFMbEpWNXZqaktETXFaVXNHWm1vdHpqTTB1K1liNkNTbnFRcVRZQVVMclp4ZUNJVjd1OE9zMVZ3eEc3MjFwYXdcbk01VFlvcnlKRmpTOWVhK1pENW8yR3VLVjlhWU4wbDdPOEJZWHhZUzRkSDdQcFE2cmFZZURKOHJmSURWTEp3NkxcbjYzTWRQdFA5ZGhYK0VkZkhkdVV5YlROSUZST2h0Q05VS0ZmbWNTOGtJZmw5SGFwSlo0UTV2ZVFvNU5Cc21JdWFcbnNrTXlLK3VDTjZsK1ZkK0FmZnpmWXhHR3BPSUpSNzVPUVVGUWhPaWhXUUtCZ1FDOHdkdENpQTRtSEV1T2g3ZzhcbnlDNTFrRjluSzZrdUd2NzhkNkVwS1dhZm00MEFtdSsxd2J5bklHUm9NM0g5YWV0NFMzRmdUQ1RvSFlGQklJN1JcbjBSWnNyUFJuUDdXWEJvRVN3NE1HZFpzKzBDZnRHeFdjbjNrdjY2MHZzRzdhYlZwSUxIb2VIZElZYm9wM0UrU1hcbkltTXBiKzVvNUFmdHJBajB3QmJNWDZkQlhRS0JnUUM2ZUNzclFUZnNMTzc3cHZWNFRlU29SeURTc3RXVDc1WVNcbkNSVUZrUzhBM3k3MGdrZHQyMXhWZXFXYUFPNWg0ZjdiSndRUCtNR21NeC85bTYzdHJzMEk5NlZQVjA4V3pNY0lcblp3ektENXVwVkZuc3JZQm43SHBjbXhDb1JhQm8velRTbk1Sb1JhN0JpWmU0VzM3QldrSmkxNks3TUNGQ1A0MVpcbjViREhOTjZpZHdLQmdRQ1RBQ3BnNnhLUnpaRnVRL1pRcDltK3h4djFma1E0V3QvZ0FNNnEvc29rWFFEM3lySUtcbmpBSCs2alFvRG9Da3lidVBLTG40TS9TK0xGUkFRem5XMzQ0bVBwL3NWT3AzM3FIZzJoQ05sRU8rTEdBYndPOFlcbjFmMk1PMi9aNXY2OTcxSFRTWWdsTWpZdnZzN3BJNzN2a2VGR0lSeTc1WExqUHdxT2laWjN2YnJGSlFLQmdBbWJcbndaVzBBWjZ3M2d1bm1jUitOd2NZeXk4d09lTXFtRkFMbWNLMHJYaGRCNzFmclRDUytob0pmTmtIclVEcjlVYnpcbnByanY5NEtKNWQ4YWs0YkkyQlhiTlBCMnJrT2RmN0FHSjFtT0hsWkdXMi9mck5zdUMwd1VUWEp1VEFxOUE4cktcbmV6Qm9UczM0T2hJczNNWTMwVzNvY0tFMnBMQVdPRUZtbllwV1JoYVhBb0dCQUpZOU4zclFkSkRWcmFUR2JDYlZcblNQNklISHE2L1BNNWM1UjNnR00veWplTTByeDBLMXlobkZKLzc2K2t1VXF6alRSaVFUaXREYVNzZEJIbXVPRDhcbkVqZWVXc2YrNUlpZ1NaWU5uazJnRlRxTy9XeUZaUm5Ya2VtZjFnM3ZYTzgvTlFGRzBDaFA1NXg2cnMwMDR5aGdcblI4TVZRYktJSHc0eklrTU9YSkV6NTdRVVxuLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLVxuIiwKICAiY2xpZW50X2VtYWlsIjogIms4cy1tYXJrZXRwbGFjZS1uZW80ai1zYUBuZW80ai1rOHMtbWFya2V0cGxhY2UtcHVibGljLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjEwNzIxODcwNzcyNTgzNjA4NTI4NiIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvazhzLW1hcmtldHBsYWNlLW5lbzRqLXNhJTQwbmVvNGotazhzLW1hcmtldHBsYWNlLXB1YmxpYy5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIKfQo=